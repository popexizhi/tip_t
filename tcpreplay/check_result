#!/bin/bash

check_log()
{
    res_log=$1
    echo "***********************check_log::${res_log}"
    pre_count=`cat ${res_log}|grep "Actual:"|sed 's/Actual: //g'|sed 's/ .*//g'`
    echo "pre_count:${pre_count}"
    t_count="process_count" 
    #t_type="capture"
    t_type="sensor"
    
    start_count=`head -n 1 ${res_log}|grep "{\"${t_count}\""|sed "s/.*${t_type}\":{\"${t_count}\"://g"|sed 's/,.*//g'`
    end_count=`tail -n 1 ${res_log}|grep "{\"${t_count}\""|sed "s/.*${t_type}\":{\"${t_count}\"://g"|sed 's/,.*//g'`

    curl_count_all=$((end_count - start_count))
    echo "${end_count} - ${start_count} = ${curl_count_all}"
    resdiff=$((pre_count-curl_count_all))
    resper=`awk 'BEGIN{printf "%.3f%\n",('${curl_count_all}'/'${pre_count}')*100}'`
    echo "[res]${resdiff}:${resper}"
    RES="${RES} \n ${res_log}:[${resdiff}:${resper}]"
}

check_out()
{
    res_log=$1
    echo "***********************check_out::${res_log}"
    type_str='"type":"dns"'
    out_num=`cat $1|grep ${type_str}|wc -l`
    echo "out_num:${out_num}"
    RES="${RES} \n${res_log}[out_num:${out_num}]"

}

get_res_dir() 
{
    RES=""
    #BASEPH="/fileserver"
    BASEPH="/fileserver/sensor"
    for dir in `ls -all ${BASEPH}/|grep "DNS"|awk '{print $9}'`
    do
        res_log=`ls ${BASEPH}/${dir}|grep log`
        res_log="${BASEPH}/${dir}/${res_log}"
        res_out=`ls ${BASEPH}/${dir}|grep out`
        res_out="${BASEPH}/${dir}/${res_out}"

        echo "${res_log}---${res_out}" 
        check_log ${res_log}
        #check_out ${res_out}
    done
    echo -e $RES
}


check_log $1
#get_res_dir 

